<?phpinclude_once 'm/Product.php';include_once 'm/Basket.php';class C_Page extends C_Base {    public function action_catalog() {        $product_object = new Product();        $catalog = $product_object->getAllProducts();        $this->title .= ' | Каталог';        $this->content = $this->Template('v/v_catalog.php', array('catalog' => $catalog));    }    public function action_product($id_product) {        $img_object = new Product();        $img = $img_object->getImg($id_product);        $firstImg = array_slice($img, 0,1);        $nextImg = array_slice($img, 1);        $product_object = new Product();        $product = $product_object->getProduct($id_product);        foreach ($product as $product);        $this->title .= ' | ' . $product['title'];        $this->content = $this->Template('v/v_product.php', array('product' => $product, 'img' => $img, 'firstImg' => $firstImg, 'nextImg' => $nextImg));    }    public function action_add() {        if ($_SESSION['id_user'] AND $_SESSION['id_role'] == "2") {            $this->title .= ' | Новый товар';            $category_object = new Product();            $category = $category_object->getCategory();            $brand_object = new Product();            $brand = $brand_object->getBrand();            $status_object = new Product();            $status = $status_object->getStatus();            $this->content = $this->Template('v/v_addEditProduct.php', array('category' => $category, 'brand' => $brand, 'status' => $status));        } else {            header('Location: index.php');        }    }    public function action_save_edit() {        if ($_SESSION['id_user'] AND $_SESSION['id_role'] == '2') {                $this->IsPost();                $product = new Product();                $product->updateProduct($_POST['id_product'], $_POST['title'], $_POST['descript'], $_POST['id_category'], $_POST['id_brand'], $_POST['count'], $_POST['price'], $_POST['id_status']);            $this->content = $this->Template('v/v_addEditProduct.php');        } else {            header('Location: index.php');        }    }    public function action_copy_save()    {        if ($_SESSION['id_user'] AND $_SESSION['id_role'] == '2') {            $inputImgs = $_FILES['files']['name'];            $this->IsPost();            $product = new Product();            $product->saveProduct($_POST['title'], $_POST['descript'], $_POST['id_category'], $_POST['id_brand'], $_POST['count'], $_POST['price'], $_POST['id_status']);            $id_product_object = new Product();            $id_product = $id_product_object->NewIdProduct();            foreach ($id_product as $new_id_product) ;            $new_id = array_pop($new_id_product);            mkdir("public/img/$new_id");            $path = "public/img/$new_id/";            $count = count($_FILES['files']['name']);            for ($i = 0; $i <= $count - 1; $i++) {                $name = $_FILES['files']['name'][$i];                $tmp_name = $_FILES['files']['tmp_name'][$i];                $full_path = $path . $name;                move_uploaded_file($tmp_name, $full_path);            }            $save_img = new Product();            $save_img->saveImage($inputImgs, $new_id);                    $this->content = $this->Template('v/v_addEditProduct.php');                    header('Location: index.php?c=page&act=catalog');                } else {            header('Location: index.php');        }    }            public            function action_edit($id_product)            {                if ($_SESSION['id_user'] AND $_SESSION['id_role'] == '2') {                    $product_object = new Product();                    $product = $product_object->getProduct($id_product);                    $img_object = new Product();                    $img = $img_object->getImg($id_product);                    foreach ($product as $product) ;                    if ($_GET['step'] == 'copy') {                        $this->title .= ' | Копирование ' . $product['title'];                    } else {                        $this->title .= ' | Редактирование ' . $product['title'];                    }                    $category_object = new Product();                    $category = $category_object->getCategory();                    $categoryEdit_object = new Product();                    $categoryEdit = $categoryEdit_object->getCategoryForEdit($product['name_category']);                    $brand_object = new Product();                    $brand = $brand_object->getBrand();                    $brandEdit_object = new Product();                    $brandEdit = $brandEdit_object->getBrandForEdit($product['brand_name']);                    $status_object = new Product();                    $status = $status_object->getStatus();                    $statusEdit_object = new Product();                    $statusEdit = $statusEdit_object->getStatusForEdit($product['name_status']);                    $this->content = $this->Template('v/v_addEditProduct.php',                        array('product' => $product,                            'category' => $category,                            'brand' => $brand,                            'status' => $status,                            'categoryEdit' => $categoryEdit,                            'brandEdit' => $brandEdit,                            'statusEdit' => $statusEdit,));                } else {                    header('Location: index.php');                }            }    public function action_delete($id_product) {        if ($_SESSION['id_user'] AND $_SESSION['id_role'] == '2') {            $path = "public/img/$id_product";            $rdir = new Product();            $rdir->RDir($path);            $product_object = new Product();            $product_object->DeleteProduct($id_product);        } else {            header('Location: index.php');        }    }}